<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="dao.appInfo.AppInfoDao">
	
	<update id="addVerOfApp">
	UPDATE app_info set versionId=#{versionId} where id=#{id}
	</update>
	
	<delete id="delAppInfo" parameterType="Integer">
		DELETE FROM app_info where id=${id}
	</delete>
	
	<update id="delfile" parameterType="int"> 
		UPDATE app_info set logoLocPath=null,logoPicPath=null where id=#{id}
	</update>
	
	<update id="updAppInfo" parameterType="AppInfo">
	UPDATE `appinfodb`.`app_info` SET  `softwareName`='${softwareName}',  `supportROM`='${supportROM}', 
	`interfaceLanguage`='${interfaceLanguage}', `softwareSize`=${softwareSize}, `updateDate`=now(), 
 	`appInfo`='${appInfo}',`flatformId`=${flatformId}, `categoryLevel3`=${categoryLevel3}, 
 	`downloads`=${downloads},  `modifyBy`=1, `modifyDate`=now(), `categoryLevel1`=${categoryLevel1},
 	 `categoryLevel2`=${categoryLevel2} ,logoPicPath=#{logoPicPath}, logoLocPath=#{logoLocPath}  WHERE `id`=${id}
	</update>
	
	<insert id="addAppInfo" parameterType="AppInfo">
		INSERT INTO `appinfodb`.`app_info` (`id`, `softwareName`, `APKName`, 
		`supportROM`, `interfaceLanguage`, `softwareSize`, `updateDate`,
`devId`, `appInfo`, `status`, `onSaleDate`, `offSaleDate`, `flatformId`, 
`categoryLevel3`, `downloads`, `createdBy`, `creationDate`, `modifyBy`, 
`modifyDate`, `categoryLevel1`, `categoryLevel2`, `logoPicPath`, `logoLocPath`, 
`versionId`) VALUES (null, #{softwareName},#{APKName}, #{supportROM}, 
#{interfaceLanguage}, #{softwareSize}, NULL, '1', #{appInfo}, '1', NULL, NULL, #{flatformId},
 #{categoryLevel3}, #{downloads}, '1', now(), NULL, NULL,
  #{categoryLevel1}, #{categoryLevel2}, #{logoPicPath},#{logoLocPath}, NULL);
		
	</insert>
	
	<select id="queryByName" resultType="AppInfo">
		SELECT * FROM app_info where APKName=#{APKName}
	</select>
	
	<update id="checkAppInfo">
		UPDATE app_info set status=#{status} where id=#{id}
	</update>
	
	
	
	<select id="queryByAidVid" resultType="AppInfo">
		SELECT * from app_info where id=#{id} 
		<if test="versionId!=null and versionId!=0">
			and versionId=#{versionId}
		</if>
		
	</select>
	
	<select id="queryCount" resultType="int">
		SELECT count(1) from app_info where 1=1 
		<if test="status!=null and status!=0 ">
			and  status=#{status}
		</if>
		<if test="softwareName!=null and softwareName!=''">
			and  softwareName like concat('%',#{softwareName},'%') 
		</if>
		<if test="flatformId!=null and flatformId!=0 ">
			and  flatformId=#{flatformId}
		</if>
		<if test="categoryLevel1!=null and categoryLevel1!=0">
			and  categoryLevel1=#{categoryLevel1}
		</if>
		<if test="categoryLevel2!=null and categoryLevel2!=0">
			and  categoryLevel2=#{categoryLevel2}
		</if>
		<if test="categoryLevel3!=null and categoryLevel3!=0">
			and  categoryLevel3=#{categoryLevel3}
		</if>
		
	</select>
	
	<select id="query" resultType="AppInfo">
		SELECT * from app_info where 1=1 
		<if test="status!=null and status!=0 ">
			and  status=#{status}
		</if>
		<if test="softwareName!=null and softwareName!=''">
			and  softwareName like concat('%',#{softwareName},'%') 
		</if>
		<if test="flatformId!=null and flatformId!=0 ">
			and  flatformId=#{flatformId}
		</if>
		<if test="categoryLevel1!=null and categoryLevel1!=0">
			and  categoryLevel1=#{categoryLevel1}
		</if>
		<if test="categoryLevel2!=null and categoryLevel2!=0">
			and  categoryLevel2=#{categoryLevel2}
		</if>
		<if test="categoryLevel3!=null and categoryLevel3!=0">
			and  categoryLevel3=#{categoryLevel3}
		</if>
		ORDER BY id desc
		limit #{from},#{pageSize}
	</select>
</mapper>