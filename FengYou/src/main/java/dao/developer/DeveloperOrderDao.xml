<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="dao.developer.DeveloperOrderDao">


	<!-- 通过id查询订单 -->
	<select id="getOrderById" resultType="Order">
		select * from `order` where
		id=#{id}
	</select>

	<!-- 通过房间id查询订单 -->
	<select id="queryOrderByHouseId" resultType="House">
		select * from
		`order` where houseId=#{houseId}
	</select>

	<!-- 添加订单 -->
	<insert id="addOrder" parameterType="Order">
		INSERT INTO `test`.`order` (
		`orderNo`, `hotelId`, `houseId`, `houseCount`, `presetItme`,
		`checkInDate`,
		`checkOutDate`, `orderStatus`, `payAmount`, `payType`,
		`place`,
		`userId`, `intoInfoId`, `remarks`) VALUES
		( #{orderNo},
		#{hotelId},
		#{houseId}, #{houseCount},#{presetItme},
		#{checkInDate},
		#{checkOutDate},
		#{orderStatus}, #{payAmount},
		#{payType}, #{place},
		#{userId},
		#{intoInfoId}, #{remarks});
	</insert>

	<!-- 添加入住信息 -->
	<insert id="addIntoinfo" parameterType="Intoinfo">
		INSERT INTO
		`test`.`intoinfo` (`userNames`, `phone`, `email`) VALUES (
		#{userNames}, #{phone}, #{email});
	</insert>

	<!-- 得到最新的入住信息 -->
	<select id="getIntoNew" resultType="Intoinfo">
		select * from `Intoinfo`
		order by id desc limit 1
	</select>

	<!-- 得到最新的订单 -->
	<select id="getOrderNew" resultType="Order">
		select * from `order` order
		by id desc limit 1
	</select>

	<!-- 查询在预定期间的订单 -->
	<select id="queryOrderByDate" resultType="Order" parameterType="Order">
				<![CDATA[
				SELECT * FROM  `order` o 
				where o.houseId=#{houseId} and  
				((o.checkInDate>=#{checkInDate} and o.checkInDate<=#{checkOutDate})  or
				(o.checkOutDate<=#{checkOutDate} and o.checkOutDate>=#{checkInDate})  )
		]]>
	</select>

	<!-- 修改订单状态和订单库存恢复状态 -->
	<update id="updOrder" parameterType="Order">
		UPDATE `test`.`order` SET `orderStatus`=#{orderStatus}
		<if test="remarks!=null and remarks!='' and remarks!=0">
			, `remarks`=#{remarks}
		</if>
		WHERE (`id`=#{id});
	</update>

	<!-- 根据用户id查询订单详情 -->
	<select id="queryOrderByUserId" resultType="Order">
		SELECT * from `order`
		WHERE userId=#{userId} order by id desc
	</select>
	
</mapper>