require.config({baseUrl:hotelPageController.commonStaticPath+"js/",urlArgs:HotelFillOrderController.appUrlVersion,paths:{loginDialog:hotelPageController.hotelStaticJsPathTmapi+"common/login_dialog",promotionInfo:hotelPageController.hotelStaticJsPathTmapi+"fillorderb/promotion_info",promotionInfoSmall:hotelPageController.hotelStaticJsPathTmapi+"fillorderb/promotion_info_small",changeDate:hotelPageController.hotelStaticJsPathTmapi+"fillorderb/fill_order_change_date",fillOrderCustomer:hotelPageController.hotelStaticJsPathTmapi+"fillorderb/fill_order_customer",fillOrderTimeLine:hotelPageController.hotelStaticJsPathTmapi+"fillorderb/fill_order_time_line",invoiceInfo:hotelPageController.hotelStaticJsPathTmapi+"fillorderb/invoice_info",invoiceTip:hotelPageController.hotelStaticJsPathTmapi+"common/invoice_tip",bindTrackEvent:pageController.hotelStaticJsPathTmapi+"fillorderb/bind_track_event"}}),require(["jquery","web","loginDialog","promotionInfo","promotionInfoSmall","changeDate","fillOrderCustomer","fillOrderTimeLine","invoiceInfo","invoiceTip","plugin/tip_new"],function($,E,loginDialog,promotionInfo,promotionInfoSmall,changeDate,fillOrderCustomer,fillOrderTimeLine,invoiceInfo,invoiceTip){$("#imgCode").on("click",function(){$(".carderror").html("")});var isCN="en"!=pageController.HotelOrderModel.language,model=hotelPageController.HotelOrderModel,insuranceSwitch=$("#insuranceSwitch"),insuranceWrap=$("div[method='insuranceWrap']"),submitOrderDOM=$("#btnSubmitOrder"),resourceMap=hotelPageController.resourceMap,needElongRisk=hotelPageController.needElongRisk,needCtripRisk=hotelPageController.needCtripRisk,changeDateClient=new changeDate,customer=new fillOrderCustomer({cityid:model.cityId,priceType:model.priceType,NeedEnglishName:model.needEnglishName,needNation:model.needNationality,isLogin:model.isLogin,language:model.language,promotionType:model.promotionType}),serverDate=hotelPageController.serverTime.substring(0,10),invoiceClient=new invoiceInfo({computeTotalMoney:onClickInsuranceSwitch}),promotion=new promotionInfo({invoiceClient:invoiceClient}),promotionInfoSmall=new promotionInfoSmall({invoiceClient:invoiceClient}),needVouchFlag=!1,noRoomDialog,invoiceTipClient=new invoiceTip,newurl="";function CalcTotalPrice(){var e=parseInt($("#rdoRoomNum1").val()),o=model.totalPrice*e;return model.isPrepay&&model.isLogin&&insuranceSwitch[0].checked&&0<model.insurancePriceList[e-1]&&(o+=model.insurancePriceList[e-1]),invoiceClient.expressWay&&invoiceClient.expressWay[0].checked&&invoiceClient.invoiceSwitch[0].checked&&1!=invoiceClient.invoiceTypedian.attr("data-selected")&&(o+=10),(o=o.toFixed(2))==parseInt(o)&&(o=parseInt(o)),o}function CalcFirstPrice(){var e=parseInt($("#rdoRoomNum1").val()),o=(model.firstPrice*e).toFixed(2);return o==parseInt(o)&&(o=parseInt(o)),o}function CalcOrigTotalPrice(){var e=parseInt($("#rdoRoomNum1").val()),o=(model.origTotalPrice*e).toFixed(2);return o==parseInt(o)&&(o=parseInt(o)),o}var utilityFormat={reFormatDateTimeString:function(e){var o,t,i,r=new Array(3),l=new Array(3),n="00",a="00",c="00",s="",d="";if(0==e.length)return"";if(d=-1<e.indexOf(":")?(s=e.substring(0,e.indexOf(" ")),e.substring(e.indexOf(" ")+1,e.length)):(s=e,""),-1<s.indexOf("-")){if(3!=(r=s.split("-")).length)return"";o=r[0],t=r[1],i=r[2]}else{if(3!=(r=s.split("/")).length)return"";o=r[2],t=r[0],i=r[1]}return-1<d.indexOf(":")&&(n=(l=d.split(":"))[0],a=l[1],c=l[2]),o.length<=2&&(o="19"+o),1==t.length&&(t="0"+t),1==i.length&&(i="0"+i),new Date(o,parseInt(t,10)-1,i,n,a,c)},formatDateString:function(e){var o,t,i,r=new Array(3);if(0==e.length)return"";if(-1<e.indexOf("-")){if(3!=(r=e.split("-")).length)return"";o=r[0],t=r[1],i=r[2]}else{if(3!=(r=e.split("/")).length)return"";o=r[2],t=r[0],i=r[1]}return o.length<=2&&(o="19"+o),2==t.length&&(t=parseInt(t,10)),2==i.length&&(i=parseInt(i,10)),o+"-"+t+"-"+i},getDay:function(e,o){switch(o){case"cn":return utilityFormat.formatDateString(e).substring(5).replace("-","月")+"日";default:return utilityFormat.formatDateString(e).substring(5).replace("-","/")}},getNextDay:function(e,o){var t=new Array;t=utilityFormat.formatDateString(e).split("-");var i=new Date(t[0],t[1]-1,t[2]),r=new Date(i-0+864e5);r.getDate();return r=r.getFullYear()+"-"+(r.getMonth()+1)+"-"+r.getDate(),this.getDay(r,o)},getYesterDay:function(e){var o=new Array;o=utilityFormat.formatDateString(e).split("-");var t=new Date(new Date(o[0],o[1]-1,o[2])-864e5);return t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()}};function time_compare_head(e,o,t){return str_format(e)+":"+str_format(o)>=t.toString()}function time_compare_headNoEqual(e,o,t){return str_format(e)+":"+str_format(o)>t.toString()}function time_compare_tail(e,o,t){return str_format(e)+":"+str_format(o)<=t.toString()}function time_compare_tailNoEqual(e,o,t){return str_format(e)+":"+str_format(o)<t.toString()}function str_format(e){return new String(e).length<=0?"":1==new String(e).length?"0"+e:e}function IsYesterDay(){var e=utilityFormat.reFormatDateTimeString(hotelPageController.serverTimeHour),o=e.getHours(),t=e.getMinutes();return time_compare_head(o,t,"00:00")&&time_compare_tail(o,t,"06:00")&&utilityFormat.reFormatDateTimeString(model.checkInDate.substring(0,10)).getTime()==utilityFormat.reFormatDateTimeString(utilityFormat.getYesterDay(serverDate)).getTime()}function GetIsAllDayVouch(){var e=model.vouchRule,o=!1;if(e==undefined||null==e)return o;var t=parseInt($("#rdoRoomNum1").val());return"1"==e.noCondition&&(o=!0),e.isRoomCountVouch&&parseInt(t)>=parseInt(e.roomCount)&&(o=!0),o}function ShowVouchInfo(e){GetIsAllDayVouch()||e?(pageController.HotelOrderModel.isVouch=!0,$("#dvVouch1").hide(),$("#dvVouch2").show(),$("#dvVouchInfo").show(),$("#dvVouchInfoLine").show(),ShowPriceInfo()):(pageController.HotelOrderModel.isVouch=!1,$("#dvVouch1").show(),$("#dvVouch2").hide(),$("#dvVouchInfo").hide(),$("#dvVouchInfoLine").hide())}function ShowButtionInfo(e){GetIsAllDayVouch()||e?model.isPrepay?submitOrderDOM.html(resourceMap["fillorder.buttion.payorder"]):submitOrderDOM.html(resourceMap["fillorder.buttion.vouchorder"]):E.isNull(model.updateOrderInfo)?submitOrderDOM.html(resourceMap["fillorder.buttion.order"]):submitOrderDOM.html(resourceMap["fillorder.buttion.conmodify"])}function ShowDailyPayInfo(e){var o=GetIsAllDayVouch(),t=CalcTotalPrice(),i=-1,r=model.vouchRule,l=parseInt($("#rdoRoomNum1").val()),n=CalcOrigTotalPrice();model.interval<=1?$("#dailyPriceDetailDiv").css("display","none"):$("#dailyPriceDetailDiv").css("display","block"),$("#daliyPriceOtherAboutTotalP").css("display","none"),$("#daliyPriceTotal").removeClass("bd_dotted");var a=!0;if(model.currenyType!=model.origCurrenyType&&(a=!1),"cn"!=model.language&&$("#dailyPriceCouponP").css("display","none"),$("#othernotes").html()!=undefined&&null!=$("#othernotes").html()&&150<$("#othernotes").html().length){var c=$("#othernotes").html();$("#othernotes").html(c.substring(0,149)+"..."),$("#othernotes").bind("mouseover",E.addEvent(this,showOtherNotesMore))}var s=0;if(2==model.promotionType&&"cn"==model.language&&(0<(s=promotion.getUpperLimit())&&$("#dailyPriceCouponText").html("立减金额："),model.isLogin&&(t=(t-s).toFixed(2))),t==parseInt(t)&&(t=parseInt(t)),$("#daliyPriceTotal").unbind("mouseover"),$("#daliyPriceOtherTotalDescText").html(resourceMap["fillorder.price.payathotel"]+":"),o||e){if(model.isPrepay)$("#daliyPriceTotalText").html(resourceMap["fillorder.price.payatonline"]),0<s&&($("#dvCouponInfo").css("display","none"),$("#dailyPriceCouponP").css("display","none")),a?($("#daliyPriceOtherTotalText").html(resourceMap["fillorder.price.payatonline"]+"："),$("#daliyPriceOtherTotalDescText").html(resourceMap["fillorder.price.payatonline"]+"："),$("#daliyPriceTotal").html(model.currenySymbol+t),$("#dailyPriceSimilarP").css("display","none"),$("#daliyPriceOtherTotalP").css("display","none"),$("#daliyPriceOtherTotalDesc").html(model.currenySymbol+t)):($("#daliyPriceTotal").html(model.currenySymbol+t),$("#dailyPriceSimilarP").css("display","none"),$("#rmbtext").css("display","none"),$("#dailyPriceSimilar").html(model.currenySymbol+t),$("#daliyPriceOtherTotalText").html(resourceMap["fillorder.price.payaboutrmb"]),$("#daliyPriceOtherTotal").html(model.currenySymbol+t),$("#daliyPriceOtherTotalP").css("display","none"),$("#daliyPriceOtherTotalDesc").html(model.currenySymbol+t),$("#daliyPriceOtherTotalDescP").css("display","block"),$("#daliyPriceOtherTotalDescText").html(resourceMap["fillorder.price.payatonline"]+"："));else if($("#daliyPriceTotalText").html(resourceMap["fillorder.price.payguaranteesonline"]),$("#daliyPriceTotal").addClass("bd_dotted"),r!=undefined&&null!=r){i=r.vouchMoneyType,vouchMoney=1==i?model.firstPrice:model.totalPrice;var d=(vouchMoney*l).toFixed(2);d==parseInt(d)&&(d=parseInt(d)),a?($("#daliyPriceOtherTotalDesc").html(model.currenySymbol+t),$("#daliyPriceOtherTotal").html(model.currenySymbol+t),$("#dailyPriceSimilarP").css("display","none")):($("#daliyPriceOtherAboutTotalP").css("display","block"),$("#daliyPriceOtherTotal").html(model.origCurrenSymbol+n),$("#daliyPriceOtherAboutTotal").html(model.currenySymbol+t),$("#daliyPriceOtherTotalDesc").html(model.origCurrenSymbol+n),$("#dailyPriceSimilarP").css("display","block"),$("#dailyPriceSimilar").html(model.currenySymbol+t)),$("#daliyPriceOtherTotalP").css("display","block"),$("#daliyPriceTotal").html(model.currenySymbol+d),$("#daliyPriceTotal").bind("mouseover",E.addEvent(this,vouchPriceOverDesc)),$("#daliyPriceOtherTotalText").html(resourceMap["fillorder.price.payathotel"]+"：")}}else $("#daliyPriceTotalText").html(resourceMap["fillorder.price.payathotel"]),$("#daliyPriceOtherTotalP").css("display","none"),a?($("#daliyPriceOtherTotalDesc").html(model.currenySymbol+t),$("#daliyPriceOtherTotalText").html(resourceMap["fillorder.price.payathotel"]+"："),$("#daliyPriceTotal").html(model.currenySymbol+t),$("#dailyPriceSimilarP").css("display","none")):($("#daliyPriceTotal").html(model.origCurrenSymbol+n),$("#dailyPriceSimilarP").css("display","block"),$("#dailyPriceSimilar").html(model.currenySymbol+t),$("#daliyPriceOtherTotalText").html(resourceMap["fillorder.price.payaboutrmb"]),$("#daliyPriceOtherTotal").html(model.currenySymbol+t),$("#daliyPriceOtherTotalP").css("display","block"),$("#daliyPriceOtherTotalDesc").html(model.origCurrenSymbol+n)),$("#daliyPriceOtherTotalDescP").css("display","block");ShowDailyPayInfoInsurance()}function ShowDailyPayInfoInsurance(){var e=parseInt($("#rdoRoomNum1").val());model.isLogin&&model.isPrepay&&insuranceSwitch[0].checked&&0<model.insurancePriceList[e-1]?(invoiceClient.expressWay&&invoiceClient.expressWay[0].checked&&invoiceClient.invoiceSwitch[0].checked&&1!=invoiceClient.invoiceTypedian.attr("data-selected")?($("#daliyPriceTotalInsurance").html(E.string.format("（含￥{0}保险、￥10快递费）",model.insurancePriceList[e-1])),$("#dailyPriceDetailExpress").show()):($("#daliyPriceTotalInsurance").html(E.string.format("（含￥{0}保险）",model.insurancePriceList[e-1])),$("#dailyPriceDetailExpress").hide()),$("#daliyPriceTotalInsurance").show(),$("#dailyPriceDetailInsurance").show(),$("#dailyPriceDetailInsuranceMoney").html("￥"+model.insurancePriceList[e-1])):(invoiceClient.expressWay&&invoiceClient.expressWay[0].checked&&invoiceClient.invoiceSwitch[0].checked&&1!=invoiceClient.invoiceTypedian.attr("data-selected")?($("#daliyPriceTotalInsurance").html("（含￥10快递费）"),$("#daliyPriceTotalInsurance").show(),$("#dailyPriceDetailExpress").show()):($("#daliyPriceTotalInsurance").hide(),$("#dailyPriceDetailExpress").hide()),$("#dailyPriceDetailInsurance").hide())}function CheckVouchByRoomNum(){var e=$("#vouchTimeLine");if(model.isPrepay)return ShowButtionInfo(!0),ShowDailyPayInfo(!0),0==e.html().length?$("#vouchTimeLineDl").css("display","none"):$("#vouchTimeLineDl").css("display","block"),!1;var o=utilityFormat.reFormatDateTimeString(hotelPageController.serverTimeHour),t=GetIsAllDayVouch(),i=!1,r=model.vouchRule,l=utilityFormat.formatDateString(serverDate),n=utilityFormat.formatDateString(model.checkInDate.substring(0,10)),a=l==n,c=-1,s=0,d=!1;r!=undefined&&null!=r&&(d=r.isArriveTimeVouch,s=1==(c=r.vouchMoneyType)?model.firstPrice:model.totalPrice);var m="";if(t&&(ShowVouchInfo(i=!0),ShowButtionInfo(!0),ShowDailyPayInfo(!0)),d){var u=parseInt(r.startTime.split(":")[0]),h=parseInt(r.startTime.split(":")[1]);m=str_format(u)+":"+str_format(h),a&&1==time_compare_head(o.getHours(),g,m)&&(i=!0)}var p=o.getHours()<23?o.getHours()+1:o.getHours(),g=o.getMinutes();23==o.getHours()&&(p+=1),60-g<5&&(p+=1);var f={from:"",to:"",arriveVouch:d,vouchStartTime:m,checkInDate:"",startDate:"",recommendTime:"",isAllVouch:!1,enableStartTime:""},y=!1,v=18,P=pageController.HotelOrderModel.timeLimit;if(P){var C=P.split("-");if(2==C.length){var T=C[0],w=C[1];a?(v=time_compare_head(p,g,T)?(f.from=p.toString()+":00",p):(f.from=T,p+4),f.isAllVouch=!0):(v=T.split(":")[0],f.from=T);var D=Number(T.substr(0,2)),b=Number(w.substr(0,2));f.to=b<D?"1."+w:w,y=!0}}else if(t){if(a){var I=p.toString()+":00";24<=p&&(I="1."+(p-24).toString()+":00"),f.from=I,f.to="1.06:00",v=p+4,y=f.isAllVouch=!0}}else if(i)f.from=p.toString()+":00",f.to="1.06:00",v=p,y=f.isAllVouch=!0;else if(y=!0,a){if(time_compare_head(p,g,"11:00")){v=p+4;I=p.toString()+":00";24<=p&&(I="1."+(p-24).toString()+":00"),f.from=I,f.to="1.06:00"}else v=15,f.from="11:00",f.to="1.06:00";d&&time_compare_head(v,"00",m)&&(v=parseInt(r.startTime.split(":")[0]),"30"==r.startTime.split(":")[1]&&(v=parseInt(r.startTime.split(":")[0])+1))}else IsYesterDay()?(f.from="0:00",f.to="06:00",f.isAllVouch=!0,f.enableStartTime=p,6<(v=o.getHours()+2)&&(v=6)):(d&&time_compare_head(v,"00",m)&&(v=parseInt(r.startTime.split(":")[0])),f.from="11:00",f.to="1.06:00");if(y){if(IsYesterDay()){var S=n.split("-"),O=new Date(S[0],S[1]-1,S[2]),k=new Date(O-0+864e5);k=k.getFullYear()+"-"+(k.getMonth()+1)+"-"+k.getDate(),f.startDate=utilityFormat.getDay(k,model.language)}else f.startDate=a&&24<=p?utilityFormat.getNextDay(n,model.language):utilityFormat.getDay(n,model.language);f.checkInDate=n,f.recommendTime=v,new fillOrderTimeLine({language:model.language,isYesToday:IsYesterDay(),vouchMoneyType:c,vouchMoney:s,callBackFunc:TimeLineCallBack}).Show(f)}else $("#vouchTimeLine").html("");0==e.html().length?$("#vouchTimeLineDl").css("display","none"):$("#vouchTimeLineDl").css("display","block"),0==e.html().length&&$("#vouchTimeLineDl").css("display","none"),pageController.HotelOrderModel.vouchRule&&(pageController.HotelOrderModel.vouchRule.isArriveTimeVouch||pageController.HotelOrderModel.vouchRule.isRoomCountVouch||$("#vouchTimeLineDl").css("display","none"))}function TimeLineCallBack(e,o){var t=e-3;if(24<e&&(t=24),utilityFormat.formatDateString(serverDate)==utilityFormat.formatDateString(model.checkInDate.substring(0,10))){var i=utilityFormat.reFormatDateTimeString(hotelPageController.serverTimeHour);i.getHours()>t&&(t=i.getHours())}e=IsYesterDay()?(t="23:59","06:00"):(24<t&&(t-=24),24<e&&(e-=24),t=24==t?"23:59":str_format(t)+":00",24==e?"23:59":str_format(e)+":00"),$("#hdShopTime").val(t+"-"+e),ShowVouchInfo("true"==o),ShowButtionInfo("true"==o),ShowDailyPayInfo("true"==o),needVouchFlag="true"==o}function ValidateMinCheckinRooms(){var e=model.minRoomCount,o=model.remainRoomCount,t=(model.roomNum,model.rpActivityType),i=$("#rdoRoomNum1");1==Number($("#rdoRoomNum1").val())&&i.empty();var r=10<o?10:o;1!=t&&2!=t||(r=1),this.roomNumMin=e,this.roomNumMax=r<e&&e<=10?e:r,this.roomNotBookFlag=10<e,1==Number($("#rdoRoomNum1").val())&&i.val(this.roomNumMin),0!=model.priceStatus&&1!=model.priceStatus&&submitOrderDOM.attr("disabled","true").addClass("disabled"),onChangeRoomNum()}function CheckRoomNumAndPrice(e){CheckInvAndPrice(e)}function ShowPriceInfo(){var e=CalcTotalPrice();CalcOrigTotalPrice();$("#spOrderTotalPrice").html(model.currenySymbol+e.toString());var o=0;if(2==model.promotionType&&model.isLogin&&"cn"==model.language){var t=(e-(o=promotion.getUpperLimit())).toFixed(2);$("#spOrderTotalPrice").html(model.currenySymbol+t==parseInt(t)?parseInt(t):t)}var i=E.template.convert('<span class="cf55 t16"><#=symbol#></span> <#=totalPrice#>',{symbol:model.currenySymbol,totalPrice:(e-o).toFixed(2)});$("#bRightTotalPrice").html(i),2==model.promotionType&&model.isLogin&&"cn"==model.language?($("#spRightReduce").show(),$("#spRightPayOnLine").hide()):($("#spRightReduce").hide(),$("#spRightPayOnLine").show());var r=e,l=model.vouchRule;l!=undefined&&null!=l&&1==l.vouchMoneyType&&(r=CalcFirstPrice());r=(r-o).toFixed(2);var n=E.template.convert("<#=symbol#><span><#=totalPrice#></span>",{symbol:model.currenySymbol,totalPrice:r==parseInt(r)?parseInt(r):r});$("#spCreditAmt").html(n),$("#spVouchRuleamount").html(n),model.isPrepay||model.currenyType==model.origCurrenyType||(e=CalcOrigTotalPrice(),$("#payRightToolTip").html(E.string.format(resourceMap["fillorder.right.selfpayprice"],model.origCurrenSymbol,e)),$("#spOrderPayToolTip").html("("+E.string.format(resourceMap["fillorder.common.selfpayprice"]+")",model.origCurrenSymbol,e)))}function onClickBtnSubmitOrder(){if("disabled"==submitOrderDOM.attr("disabled"))return!1;var e={},o=customer.GetCurstomerInfo();if(!o.success)return!1;var t=invoiceClient.getInvoiceInfo();if(!t.success)return!1;console.log("invoiceObj:",t);var i=$("#imgCode");if(0<i.length&&!E.validate.valid(E.string.trim(i.val()),"notEmpty"))return $(".carderror").html("<span>"+resourceMap["fillorder.code.errordesc"]+"</span>"),!1;0<i.length&&(e.checkCode=i.val()),e.hotelGuestList=o.value,e.hotelContacter=o.value[0],e.hotelGuestListMap=o.map,E.isNull(t.invoiceData)||(e.HotelInvoice=t.invoiceData),e.roomNum=parseInt($("#rdoRoomNum1").val());var r,l,n=IsYesterDay()?"23:59":"14:00",a=IsYesterDay()?"06:00":"20:00";if(model.isPrepay)e.timeEarly=n,e.timeLater=a;else if(GetIsAllDayVouch()){var c=$("#hdShopTime").val();E.string.isNullOrEmpty(c)?(e.timeEarly=n,e.timeLater=a):(e.timeEarly=c.split("-")[0],e.timeLater=c.split("-")[1])}else{c=$("#hdShopTime").val();if(E.string.isNullOrEmpty(c))return void alert("到店时间选择错误");e.timeEarly=c.split("-")[0],e.timeLater=c.split("-")[1]}(GetIsAllDayVouch()||needVouchFlag)&&(e.isVouch=!0),e.useCoupon=!0,e.insertUpdateHotelOrderTime=1,e.isReceElongSms="true"==$("#spReceElongSms").attr("checked"),e.insuranceChecked=insuranceSwitch[0].checked,submitOrderDOM.attr("disabled","true").addClass("disabled"),this.loadDialog=new E.dialog({title:"",htmlContent:$("#dvSubmitLoading").html(),width:560,height:67,DialogEvent:function(){}}),this.loadDialog.show(),e.rnd=Math.random();try{needCtripRisk&&(window.__cfpi=window.__cfpi||[],window.__cfpi.push(["_getChloroToken",function(e){r=e}],!1)),needElongRisk&&(l=window.fingerPrintToken||localStorage.getItem("_fid"))}catch(s){console.log("token获取失败",s)}e.chloroToken=r,e.elongToken=l,submitOrderInfo(window.reqModel=e)}function submitOrderInfo(e){E.ajax.exec(pageCommonPath.submitorder,{orderKey:pageController.orderCacheKey,requestModel:e,hotelId:pageController.HotelOrderModel.hotelId,roomTypeId:pageController.HotelOrderModel.roomId,ratePlanId:pageController.HotelOrderModel.rpId,uniqueId:pageController.HotelOrderModel.uniqueId,recomPolicy:getQueryString("recomPolicy")||0},E.addEvent(this,callback),"POST")}function getQueryString(e){var o=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),t=(window.location.href,window.location.search.substr(1).match(o));return null!=t?t[2]:null}function callback(e){if(this.loadDialog&&this.loadDialog.close(),e&&e.success&&e.value){var o=e.value;if(o.jumpUrl)return void(window.location=o.jumpUrl);if(0!=o.success)return void window.location.reload();showDialogTips(o)}submitOrderDOM.removeAttr("disabled","true").removeClass("disabled")}function showDialogTips(e){var o='<div class="check-invand-dialog"><a class="icon_close_sale" href="javascript:void(0);" method="close"></a><div class="dialog-title"><b>'+e.message+"</b>";if(e.checkInDateStr&&e.checkOutDateStr?o+='<div class="dialog-date"><span>'+e.checkInDateStr+"</span> "+(isCN?" 入住 - ":"Check-in")+"<span>"+e.checkOutDateStr+"</span>"+(isCN?" 退房 ":"Check-out")+"</div></div>":o+="</div>",e.suggestions&&e.suggestions.length){var t=e.suggestions;o+='<div class="dialog-tip">'+(isCN?" 您可以： ":"You can")+"</div>";for(var i=0;i<t.length;i++)o+='<div class="dialog-tip">'+t[i]+"</div>"}if(e.buttons&&e.buttons.length){o+='<div class="dialog-btns tc">';for(i=0;i<e.buttons.length;i++){var r=e.buttons[i],l=!isNaN(r.url);o+='<a href="'+(l?"javascript:void(0);":r.url)+'" class="com_dialog-btn  '+(1==r.type?"stress":"")+'" '+(l?'method="'+r.url+'"':"")+">"+r.text+"</a>"}o+="</div>"}this.tipsDialog=new E.dialog({title:"",htmlContent:o,width:655,DialogEvent:E.addEvent(this,function(e){var o=this;$(".com_dialog-btn",e).on("click",function(){var e=$(this).attr("method");switch(o.tipsDialog.close(),e){case"1":$("#aChangeDate").click();break;case"2":break;case"3":window.reqModel.insertUpdateHotelOrderTime+=1,submitOrderInfo(window.reqModel);break;case"4":window.location.reload()}})})}),this.tipsDialog.show()}function ShowReduceInfo(){var e=0;2==model.promotionType&&"cn"==model.language&&(e=promotion.getUpperLimit(),$("#spRightReduce").html(E.string.format(resourceMap["fillorder.common.enjoyreduce"],model.currenySymbol,e)),$("#PromotionTotalAmount").html(e))}function showInsuranceCancelView(){var e=parseInt($("#rdoRoomNum1").val());$("#insurancePrice").html("￥"+model.insurancePriceList[e-1]),insuranceWrap.hide(),insuranceSwitch[0].checked=!1}function ShowIsOnTime(){var e=parseInt($("#rdoRoomNum1").val());if(model.isOnTime){var o=model.onTimeConfirmAmount;if(-1==o&&(o=4),e<=(o=4<=o?4:o))$("#isOnTimeProduct").css("display","block"),$("#isOnTimePrompt").css("display","none");else if(2<=e){var t="cn"==model.language?'<p><i class="icon_cancel_n mr5"></i>您预订了多间客房，订单提交后，酒店需要一些时间来确认您的订单，请耐心等待</p>':'<p><i class="icon_cancel_n mr5"></i>You have changed the number of rooms.We need some time to confirm your order after you reserved.</p>';$("#isOnTimePrompt").html(t),$("#isOnTimePrompt").css("display","block"),$("#isOnTimeProduct").css("display","none")}}else $("#isOnTimeProduct").css("display","none"),$("#isOnTimePrompt").css("display","none")}function cuDialogClick(){$(".cuChangeDialogWrap .Topclose").on("click",function(){window.location.reload(),$(".cuChangeDialogWrap").hide()}),$(".cuChangeDialogWrap .surebtn").on("click",function(){window.location.reload(),$(".cuChangeDialogWrap").hide()})}function onChangeRoomNum(e){customer.ShowRoom(parseInt($("#rdoRoomNum1").val())),invoiceClient.showRemarkRoomNum(parseInt($("#rdoRoomNum1").val())),CheckRoomNumAndPrice(e),showInsuranceCancelView(),ShowPriceInfo(),"cn"==model.language&&(promotion.PromotionView(),promotionInfoSmall.PromotionView()),ShowReduceInfo(),ShowIsOnTime(),CheckVouchByRoomNum(),InitLogin(),$("#bottomRoomNum").html($("#rdoRoomNum1").val()+resourceMap["fillorder.right.roomnums"]),this.roomNotBookFlag&&roomMinBookTenUp(),0<promotion.getUpperLimit()?($(".redBugTip ul li.cup0 label").html("￥"+promotion.getUpperLimit()),$("#dailyPriceCoupon").html("￥"+promotion.getUpperLimit()),$("#daily_romms_amount").html("￥"+promotion.getUpperLimit())):($(".redBugTip ul li.cup0").html(""),$("#dailyPriceCouponP").html(""),$("#dailyPriceCouponP").css("display","none"),$("#daily_romms_p").css("display","none")),0<promotion.getLiJianPrice()?($(".coutip").html("<span>已减¥"+promotion.getLiJianPrice()+"</span>"),$("#yiJian").html("已立减：<em>¥"+promotion.getLiJianPrice()+"</em>")):($("#yiJian").html(""),$(".coutip").html("")),0<promotion.getTiantianPrice()?$(".redBugTip ul li.cup1 label").html("￥"+promotion.getTiantianPrice()):$(".redBugTip ul li.cup1").html(""),0<promotion.getCurrentMonthPrice()?$(".redBugTip ul li.cup2 label").html("￥"+promotion.getCurrentMonthPrice()):$(".redBugTip ul li.cup2").html(""),0<promotion.getSuperCouponPrice()?$(".redBugTip ul li.cup3 label").html("￥"+promotion.getSuperCouponPrice()):$(".redBugTip ul li.cup3").html("")}function onChangeRoomNumReduce(){var e=parseInt($("#rdoRoomNum1").val());if(e<=this.roomNumMin)return!1;10==e&&this.roomNumMin<10&&$("#tenUpError").css("display","none"),e==this.roomNumMax&&this.roomNumMin<this.roomNumMax&&$("#numLimitError").css("display","none"),$("#rdoRoomNum1").val(e-1),onChangeRoomNum("changeurl")}function onChangeRoomNumAdd(){var e=parseInt($("#rdoRoomNum1").val());if(e>=this.roomNumMax){if(10<=this.roomNumMax)$("#tenUpError").css("display","block");else{var o="cn"==model.language?'<p><i class="icon_cancel_n mr5"></i>该房型仅剩{0}间可订</p>':'<p><i class="icon_cancel_n mr5"></i>Only {0} room</p>';o=E.string.format(o,this.roomNumMax),$("#numLimitError").html(o),$("#numLimitError").css("display","block")}return!1}$("#rdoRoomNum1").val(e+1),onChangeRoomNum("changeurl")}function CheckInvAndPrice(c){E.ajax.exec(pageCommonPath.checkbookablenew,{RoomCount:$("#rdoRoomNum1").val(),cacheKey:hotelPageController.orderCacheKey},function(e){e&&e.success&&e.value&&!e.value.success&&showDialogTips(e.value);var o=!1;if(c&&("G"==hotelPageController.permotionVersion&&hotelPageController.isLogin||"E"==hotelPageController.permotionVersion)&&e&&e.success&&e.value&&e.value.success&&e.value.data&&0<e.value.data.length)for(var t=e.value.data,i=0;i<t.length;i++){var r=t[i],l=r.date,n=r.price,a=$("#dailyPriceDetail .pri_date").find("b[data-date='"+l+"'] i").text();if(Number(a)!=n){o=!0;break}}o&&addUrlPara("roomCount",$("#rdoRoomNum1").val(),"show")},"POST")}function addUrlPara(paramName,replaceWith,flag){var oUrl=this.location.href.toString(),re=eval("/("+paramName+"=)([^&]*)/gi"),nUrl=oUrl.replace(re,paramName+"="+replaceWith);newurl=nUrl,history.pushState(null,null,nUrl),"show"==flag&&showRoomNumChangeDilog()}function showRoomNumChangeDilog(){$(".cuChangeDialogWrap").show(),window.location.hash=$("#rdoRoomNum1").val()}function roomMinBookTenUp(){submitOrderDOM.attr("disabled","true").addClass("disabled"),(noRoomDialog=new E.dialog({title:resourceMap["fillorder.roomTenUp.title"],htmlContent:$("#dvRoomMinBookTenUp").html(),width:560,height:67,DialogEvent:E.addEvent(this,function(e){this.m_noroom=e.find("div[data-model='roomMinBookTenUpContent']"),this.m_noroom.bind("click",onClickNoRoom)})})).show()}function onClickNoRoom(e){switch(E.event.element(e).attr("method")){case"btnleft":noRoomDialog.close();break;case"btnright":null==hotelPageController.HotelOrderModel||null==hotelPageController.HotelOrderModel.updateOrderInfo?hotelPageController.DeleteHotelDetailCache(hotelPageController.orderCacheKey,function(e){null!=e&&e.success&&e.value&&e.value.content?window.location=e.value.content:hotelPageController.HotelOrderModel&&hotelPageController.HotelOrderModel.hotelId?window.location=E.string.format("http://hotel.elong.{0}/{1}/","en"==hotelPageController.HotelOrderModel.language?"net":"com",hotelPageController.HotelOrderModel.hotelId):window.location="/"},E,"POST"):hotelPageController.HotelOrderModel&&hotelPageController.HotelOrderModel.updateOrderInfo&&(window.location=E.string.format("/updateOrder_{0}.html?UserStartDate={1}&UserEndDate={2}",hotelPageController.HotelOrderModel.updateOrderInfo.oldReserNo,E.string.cut(hotelPageController.HotelOrderModel.checkInDate,10),E.string.cut(hotelPageController.HotelOrderModel.checkOutDate,10)))}}function InitLogin(){$("[data-login=true]").unbind("click"),$("[data-login=true]").bind("click",function(){loginDialog({language:model.language,callback:function(){window.location.reload()}})})}function ShowOrderIn24Hour(){hotelPageController.GetOrderCountIn24Hours(model.hotelId,function(e){e&&e.success&&e.value.isSuccess&&($("#dvOrderNew").show(),$("#rightInfoContainer").show())},E,"POST")}function SetHeightSame(){$("[placeholder]").focus(function(){var e=$(this);e.val()==e.attr("placeholder")&&(e.val(""),e.removeClass("placeholder"),e.removeClass("c999"))}).blur(function(){var e=$(this);""!=e.val()&&e.val()!=e.attr("placeholder")||(e.addClass("placeholder"),e.addClass("c999"),e.val(e.attr("placeholder")))}),model.isLogin||""!=$("#inContactPhone").val()||($("#inContactPhone").val($("#inContactPhone").attr("placeholder")),$("#inContactPhone").addClass("c999")),$("div[class='bottom_nav bottom_nav_en']").hide(),model.interval<=1&&$("#spOrderTotalPrice").removeClass("bd_dotted");setInterval(function(){var e=$(".edit_booking_wrap.right").height();$(".hotel_inf.left").css("height",e+"px")},200)}function ChangeDate(){$(".noRoomSubmit p").css("display","none"),changeDateClient.ProcessView()}function RefreshValidImg(){var e=$("#validateImg"),o=e.attr("tmpsrc")+"?rnd="+Math.random();e.attr("src",o)}function onClickBtnPricedetail(){"none"==$("#pricedivinfo").attr("isdis")?($("#pricedivinfo").attr("isdis","block"),$("#pricedivinfo").show(),$("#pricedaydiv").html($("#hidepmessage").attr("message"))):($("#pricedivinfo").attr("isdis","none"),$("#pricedivinfo").hide(),$("#pricedaydiv").html($("#showpmessage").attr("message")))}function onClickInsuranceSwitch(){ShowPriceInfo(),"cn"==model.language&&(promotion.PromotionView(),promotionInfoSmall.PromotionView()),CheckVouchByRoomNum()}function onClickBtnDailPriceDetail(){"none"==$("#dailyPriceDetail").attr("isdis")?($("#dailyPriceDetail").attr("isdis","block"),$("#dailyPriceDetail").show(),$("#dailyPriceDetailA").html($("#dailyPriceDetailHidepmessage").attr("message")),$("#dailyPriceDetailI").removeClass("ui_icons_more"),$("#dailyPriceDetailI").addClass("ui-icon-less")):($("#dailyPriceDetail").attr("isdis","none"),$("#dailyPriceDetail").hide(),$("#dailyPriceDetailA").html($("#dailyPriceDetailShowpmessage").attr("message")),$("#dailyPriceDetailI").removeClass("ui-icon-less"),$("#dailyPriceDetailI").addClass("ui_icons_more"))}function onClickBtnHotelRoomInfo(){"none"==$("#hotelRoomInfoUl").attr("isdis")?($("#hotelRoomInfoUl").attr("isdis","block"),$("#hotelRoomInfoUl").show(),$("#hotelRoomInfoDiv").html($("#hotelRoomInfoHidepmessage").attr("message")),$("#hotelRoomInfoDivI").removeClass("ui_icons_more"),$("#hotelRoomInfoDivI").addClass("ui-icon-less")):($("#hotelRoomInfoUl").attr("isdis","none"),$("#hotelRoomInfoUl").hide(),$("#hotelRoomInfoDiv").html($("#hotelRoomInfoShowpmessage").attr("message")),$("#hotelRoomInfoDivI").removeClass("ui-icon-less"),$("#hotelRoomInfoDivI").addClass("ui_icons_more"))}function priceOverdetail(e){if(!(model.interval<=1)){var o=E.event.element(e);this.priceTemplate=$("#dailyPriceDetail").html(),null!=this.tipWindow&&this.tipWindow.close(),this.tipWindow=new E.tip({content:this.priceTemplate,eventElement:o,defer:!1})}}function identifyExplain(e){var o=E.event.element(e);this.identifyExplainTemplate=$("#identifyExplain").html(),null!=this.tipWindow&&this.tipWindow.close(),this.tipWindow=new E.tip({content:this.identifyExplainTemplate,eventElement:o,defer:!1})}function vouchPriceOverDesc(e){var o=E.event.element(e);this.priceTemplate=E.string.format("订单提交后需在线支付{0}担保金，如未预订成功，担保金全部原路退还；入住结账，艺龙向酒店确认后，担保金全额原路退还。",$("#daliyPriceTotal").html()),"en"==hotelPageController.HotelOrderModel.language&&(this.priceTemplate=E.string.format("Rooms shortage,please pay the room rate {0} online after your order submitted. We will refund to your payment account with the unsuccessful confirmation.",$("#daliyPriceTotal").html())),null!=this.tipWindow&&this.tipWindow.close(),this.tipWindow=new E.tip({content:this.priceTemplate,eventElement:o,defer:!1})}function showOtherNotesMore(e){if(null!=model.otherNotes&&150<model.otherNotes.length){var o=E.event.element(e);this.otherNotes=model.otherNotes,null!=this.tipWindow&&this.tipWindow.close(),this.tipWindow=new E.tip({content:this.otherNotes,eventElement:o,defer:!1})}}function onInvoiceTip(){new E.dialog({title:"发票须知",htmlContent:"内容还未提供.",width:560,height:360,DialogEvent:function(){}}).show()}function bindingTrackEvent(e,o,t,i){window._tcTraObj&&_tcTraObj._tcTrackEvent(e,o,t,i)}function onBodyClick(e){switch(E.event.element(e).attr("method")){case"userLogin":loginDialog({language:model.language,callback:function(){bindingTrackEvent("HotelOrder","click","促登录框",pageController.isLogin),window.location.reload()}})}}function initDialogRoomSoldOut(){$(".fullDialogWrap .leavebtn").on("click",function(){window.location.href="/FengYou/toIndex3?hotelId="+hotelPageController.HotelOrderModel.hotelId+"/"}),$(".fullDialogWrap .bookConbtn").on("click",function(){$(".fullDialogWrap").hide()}),$(".fullDialogWrap .Topclose").on("click",function(){$(".fullDialogWrap").hide()}),$(".fullDialogWrap .surebtn").on("click",function(){$(".fullDialogWrap").hide()});var e=location.hash;window.history&&window.history.pushState&&($(window).on("popstate",function(){e===location.hash&&(history.pushState(null,null,document.URL),$(".fullDialogWrap .content p").html(wanLiuTipShow()),$(".fullDialogWrap").show())}),window.history.pushState("forward",null,"#"),window.history.forward(1))}function wanLiuTipShow(){if("true"==getQuery("isMinProduct","","&"))return"您选择了本房型最低价产品,犹豫可能随时被抢订,赶紧预订哟";if(0<getUpperLimit())return'预订本房间可享<span style="color:#ff5555">&yen;'+getUpperLimit()+"</span>优惠,优惠不等人,赶紧预订哟";if(1==pageController.HotelOrderModel.payType&&!pageController.HotelOrderModel.isVouch)return"无需提前支付房费,酒店免费保留房间,赶紧预订哟";for(var e=!1,o=0;o<$("[data-handle=person]").length;o++)$("[data-handle=person]").eq(o)&&$("[data-handle=person]").eq(o).val().length&&"姓名，只需填写一位"!=$("[data-handle=person]").eq(o).val()&&(e=!0);return e||$("#inContactPhone").val()&&$("#inContactPhone").val().length&&"您将收到确认短信"!=$("#inContactPhone").val()&&(e=!0),e||$("#inContactEmail").val()&&$("#inContactEmail").val().length&&(e=!0),e?"返回后不保留本次填写信息,还差一步就完成了,确定退出吗?":"只差一步就完成预订 ,确认退出吗?"}function getQuery(e,o,t){return t=t||"#",new RegExp("(^|\\"+t+"|&)"+e+"=([^&]*)(\\s|&|$)","i").test(location.href)?unescape(RegExp.$2.replace(/\+/g," ")):o}function getUpperLimit(){var e=0<hotelPageController.HotelOrderModel.reduceAmount?hotelPageController.HotelOrderModel.reduceAmount:hotelPageController.HotelOrderModel.dayLimit,o=hotelPageController.HotelOrderModel.tiantiantejia+hotelPageController.HotelOrderModel.superCouponAmount+hotelPageController.HotelOrderModel.currentMonthAmount;return"G"==hotelPageController.permotionVersion&&!hotelPageController.isLogin||"F"==hotelPageController.permotionVersion||"H"==hotelPageController.permotionVersion||"Z"==hotelPageController.permotionVersion?Math.round($("#rdoRoomNum1").val()*e*hotelPageController.HotelOrderModel.interval):Math.round($("#rdoRoomNum1").val()*e*hotelPageController.HotelOrderModel.interval+$("#rdoRoomNum1").val()*o)}!function(){cuDialogClick(),InitLogin(),initDialogRoomSoldOut(),addUrlPara("roomCount",1),$("body").bind("click",E.addEvent(this,onBodyClick)),$("a[name='btnReduce']").bind("click",E.addEvent(this,onChangeRoomNumReduce)),$("a[name='btnAdd']").bind("click",E.addEvent(this,onChangeRoomNumAdd)),$("#spOrderTotalPrice").bind("mouseover",E.addEvent(this,priceOverdetail)),$("#invoiceIdentifyExplain").bind("mouseover",E.addEvent(this,identifyExplain)),$("#aChangeDate").bind("click",ChangeDate),submitOrderDOM.bind("click",onClickBtnSubmitOrder),$("#changeImgCode").bind("click",RefreshValidImg),$("#pricedaydiv").bind("click",onClickBtnPricedetail),$("#dailyPriceDetailDiv").bind("click",onClickBtnDailPriceDetail),$("#hotelRoomInfoDiv").bind("click",onClickBtnHotelRoomInfo),$("#aInvoiceTip").bind("click",invoiceTipClient.onInvoiceTip),$(".sTipsShowAll").on("click",function(){$(".sTipsShowAll").addClass("none"),$(".caNumberTips").removeClass("none")}),insuranceSwitch.bind("click",onClickInsuranceSwitch),ValidateMinCheckinRooms(),SetHeightSame(),require(["bindTrackEvent"])}()});