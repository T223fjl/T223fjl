require.config({baseUrl:IndexController.commonStaticPath+"js/",urlArgs:IndexController.appUrlVersion,paths:{searchBox:IndexController.hotelStaticJsPathTmapi+"common/search_box",lazyLoad:IndexController.hotelStaticJsPathTmapi+"common/lazy_load",emergencyNotice:IndexController.hotelStaticJsPathTmapi+"common/emergency_notice",slider:IndexController.hotelStaticJsPathTmapi+"common/slider"}}),require(["jquery","web","searchBox","slider","lazyLoad","emergencyNotice"],function(r,l,a){new(l.module.create({options:{FlightPromotion:[]},init:function(){this.serverTime=IndexController.serverTime,this.vmData=IndexController.vm,this.login=!!this.vmData&&this.vmData.login,this.initializeDOM(),this.initializeData(),this.initializeEvent(),this.render()},bindingTrackEvent:function(t,e,i,a){window._tcTraObj&&_tcTraObj._tcTrackEvent(t,e,i,a)},initializeDOM:function(){this.searchTab=r("#searchTabs"),this.searchTabs=r("#searchTabs>li"),this.hotelSubTabs=r("#hotel_sub_tabs>span"),this.domesticDiv=r("#domesticDiv"),this.myRecordTab=r("#my_record_tabs span"),this.hideMyRecords=r(".open_wrap>i:first"),this.disPlaneTricketTabs=r("#discount_plane_tricket>h3>span"),this.disTrainTricketTabs=r("#discount_train_tricket>h3>span"),this.go2HotelList=r("[method='go2HotelList']"),this.all_search=r(".all_search")},initializeEvent:function(){this.searchTabs.bind("click",l.addEvent(this,this.onSearchTabsClick)).bind("mouseover",l.addEvent(this,this.onSearchTabsHover)),this.hotelSubTabs.bind("click",l.addEvent(this,this.onHotelSubTabClick)),this.myRecordTab.bind("click",l.addEvent(this,this.onMyRecordTabClick)),this.hideMyRecords.bind("click",l.addEvent(this,this.onHideMyRecords)),this.disPlaneTricketTabs.bind("click",l.addEvent(this,this.ondisPlaneTricketTabs)),this.disTrainTricketTabs.bind("click",l.addEvent(this,this.ondisTrainTricketTabs)),this.go2HotelList.bind("click",l.addEvent(this,this.ongo2HotelListClick)),r(".domestic h3>span").bind("click",this.onSubmoduleTabsClick),this.imgLazyLoad(),r(".tab_pic_show ul li").hover(function(){var t=r(this),e=t.parents(".tab_pic_show"),i=t.index();t.addClass("on").siblings().removeClass("on"),r("ol li",e).hide().eq(i).show()}),r("#sm li").hover(function(){r(this).addClass("active").siblings("li").removeClass("active")}),r(".bottom_nav li").bind("click",function(){var t=r(this);t.addClass("action").siblings().removeClass("active");var e=t.index();r("div.bottom_con").hide().eq(e).show()});var t=r("#domesticDiv [data-bindid='city']"),e=r("#domesticDiv [data-bindid='checkIn']"),i=r("#domesticDiv [data-bindid='checkOut']"),a=(r("#domesticDiv [data-bindid='allInOne']"),this);r("#domesticDiv input[data-bindid='city']").on("change",function(){a.bindingTrackEvent("pc-elong-homepage","click","澶ч椤�-閰掑簵tab-鍥藉唴閰掑簵tab-鐩殑鍦�",r(this).val())}),r("#domesticDiv input[data-bindid='checkIn'],#domesticDiv input[data-bindid='checkOut']").on("change",function(){a.bindingTrackEvent("pc-elong-homepage","click","澶ч椤�-閰掑簵tab-鍥藉唴閰掑簵tab-鍏ョ鏃ユ湡",t.val()+"^"+e.val()+"^"+i.val())}),r("#domesticDiv input[data-bindid='allInOne']").on("change",function(){a.bindingTrackEvent("pc-elong-homepage","click","澶ч椤�-閰掑簵tab-鍥藉唴閰掑簵tab-鎼滅储妗�",t.val()+"^"+e.val()+"^"+i.val()+"^"+r(this).val())}),r("#pcAdv li").on("click",function(){a.bindingTrackEvent("pc-elong-homepage","click","澶ч椤�-banner","")}),r(".fold_wrap ul li").on("click",function(){a.bindingTrackEvent("pc-elong-homepage","click","澶ч椤�-涓婚閰掑簵","涓婚绫诲瀷")}),r(".termini li").on("click",function(){a.bindingTrackEvent("pc-elong-homepage","click","澶ч椤�-鐩殑鍦版寚鏁�","")})},render:function(){this.lazyLoadCmsPicture(),this.searchBox=new a({pageType:"index",searchBoxWrap:this.domesticDiv,language:this.language,serverTime:this.serverTime,host:"http://hotel.elong.com"});var t=this.getHistoryHotelIds();if(hotelPageController.getHoteBasicInfo(t,l.addEvent(this,this.rendingMyBrowsingHistory),l,"GET","json",3e4),hotelPageController.enabledYesterday){var e=l.date.addNDate(new Date(hotelPageController.serverTime),-1);this.domesticDiv.prepend('<div class="early-morning-tooltip">浠婃棩0-6鐐瑰叆浣忥紝鍏ヤ綇鏃ユ湡璇烽€夋嫨'+(e.getMonth()+1)+"鏈�"+e.getDate()+"鏃�(鏄ㄦ棩)</div>")}},imgLazyLoad:function(){r(".termini img").lazyLoad({backgroundPosition:"center 40px",backgroundSize:"120px 120px;"}),r(".raiders img").lazyLoad({backgroundSize:"120px 120px;"})},onSearchTabsHover:function(){require(["http://m.elongstatic.com/static/webapp/flight/websiteMain/flight.js"]),require(["http://m.elongstatic.com/static/webapp/flight/websiteMain/train/train.js"])},onSubmoduleTabsClick:function(t){var e=r(this),i=e.parents(".domestic"),a=r("h3 span",i).removeClass("on").index(e);e.addClass("on"),r(".tab_theme",i).hide().eq(a).show(),scroll&&scroll(0,r(document).scrollTop()+1)},onSearchTabsClick:function(t){var e=l.event.element(t),i=e.parents("li"),a=i.attr("index");a!=undefined&&(0==a&&this.bindingTrackEvent("pc-elong-homepage","click","澶ч椤甸厭搴梩ab","鍥藉唴閰掑簵^鍥介檯閰掑簵"),1==a&&this.bindingTrackEvent("flightDIndexPage_flightTab","click","澶ч椤靛垏鎹㈡満绁╰ab鐐瑰嚮","鍥藉唴鏈虹エ^鍥介檯鏈虹エ"),e.parent().hasClass("last")?e.parent().next().addClass("emty2"):e.parent().parent().find(".emty").removeClass("emty2"),this.searchTabs.removeClass("on"),this.loadingPanel(a),i.addClass("on"))},loadingPanel:function(t){var e=r(".cate_channel_option").children();if(!(t>e.length||t<0||t==undefined)){e.hide();var i=e[t];r(i).show()}},onHotelSubTabClick:function(t){this.hotelSubTabs.removeClass("on");var e=l.event.element(t).parent();e.addClass("on");var i=e.attr("sub_index");i<0||i>this.hotelSubTabs.length||(0==i&&this.bindingTrackEvent("pc-elong-homepage","click","澶ч椤�-閰掑簵tab-鍥藉唴閰掑簵tab鐐瑰嚮",""),this.loadingHotelSubPanel(i))},loadingHotelSubPanel:function(t){var e=r("[panel='hotelSubPanel']");e.hide(),t>e.length||t<0||r(e[t]).show()},onMyRecordTabClick:function(t){var e=l.event.element(t);r(".tab_option span").removeClass("on"),r(e).addClass("on");var i=parseInt(r(e).attr("index"));switch(r(".smain_list").css("display","none"),i){case 2:r("#my_record_fav").css("display","block"),hotelPageController.getFavHotelInfosByPage(l.addEvent(this,this.rendingMyRecordFav),l,"GET","json",3e4);break;case 1:r("#my_record_comment").css("display","block"),hotelPageController.getOrderToReview(l.addEvent(this,this.rendingMyWaitReview),l,"GET","json",3e4);break;case 0:r("#my_record_history").css("display","block");var a=this.getHistoryHotelIds();hotelPageController.getHoteBasicInfo(a,l.addEvent(this,this.rendingMyBrowsingHistory),l,"GET","json",3e4)}},rendingMyRecordFav:function(t){this.login?(r(".no_record").hide(),(!t||!t.value||t.value.length<=0)&&(r("#my_record_favs").hide(),r("#my_record_no_fav").slideDown(1e3)),l.stringbuilder.clear(),t&&t.value&&(_this=this,r.each(t.value,function(){var t=_this.hide_fav_temp,e=l.template.convert(t,{Address:this.SowntownName,Name:this.HotelName,Url:this.HotelUrl,Image_Url:this.HotelImg,Price:_this.getHotelPriceHtml(this.LowPrice)});l.stringbuilder.append(e)})),r("#my_record_favs").html(""),r("#my_record_favs").append(l.stringbuilder.toString()),l.stringbuilder.clear(),r(".my_record").slideDown(1e3),r(".open_wrap >i").show()):(r(".my_record").hide(),r(".open_wrap >i").hide(),hotelPageController.showLoginOption&&r(".no_record").slideDown(1e3))},rendingMyWaitReview:function(t){if(this.login){if(!t||!t.value||t.value.length<=0)return r("#my_record_comments").hide(),void r("#my_record_no_comment").show();l.stringbuilder.clear();for(var e=0,i=this.hide_comment_temp,a=0;a<t.value.length&&!(4<e);a++)l.stringbuilder.append(l.template.convert(i,{Name:t.value[a].hotelName,Url:t.value[a].commentUrl,Image_Url:t.value[a].hotelImageUrl,Hotel_Url:t.value[a].hotelUrl})),e++;0<e?(r("#my_record_comments").html(""),r("#my_record_comments").append(l.stringbuilder.toString()),l.stringbuilder.clear()):(r("#my_record_comments").hide(),r("#my_record_no_comment").show())}else r(".my_record").hide(),r(".open_wrap >i").hide(),hotelPageController.showLoginOption&&r(".no_record").show()},rendingMyBrowsingHistory:function(t){this.login?(r("#no_record").hide(),t&&t.value&&0<t.value.length?(l.stringbuilder.clear(),r("#my_record_historys").html(""),_this=this,r.each(t.value,function(){var t=_this.hide_fav_temp,e=l.template.convert(t,{Address:this.SowntownName,Name:this.HotelName,Url:this.HotelUrl,Image_Url:this.ImageUrl,Price:_this.getHotelPriceHtml(this.LowPrice)});l.stringbuilder.append(e)}),r("#my_record_historys").append(l.stringbuilder.toString()),l.stringbuilder.clear()):(r("#my_record_historys").hide(),r("#my_record_no_history").show()),r(".my_record").slideDown(1e3),r(".open_wrap >i").show()):(r(".my_record").hide(),r(".open_wrap >i").hide(),hotelPageController.showLoginOption&&r(".no_record").slideDown(1e3))},getHotelPriceHtml:function(t){return t&&"0"!=t?"<p>楼<span>"+t+"</span>璧�</p>":"<p>璁㈠畬</p>"},onHideMyRecords:function(t){var e=l.event.element(t),i=r(".my_record");r(e).hasClass("icon04a")?(r(e).removeClass("icon04a"),i.slideUp()):(r(e).addClass("icon04a"),i.slideDown())},pageTop:function(){var t=document,e="ipad"==navigator.userAgent.toLowerCase().match(/iPad/i)?window.pageYOffset:Math.max(t.documentElement.scrollTop,t.body.scrollTop);return t.documentElement.clientHeight+e},getHistoryHotelIds:function(){var t=l.cookie.get("SHBrowseHotel",this.language),e="";if(!l.string.isNullOrEmpty(t))for(var i=t.split(";"),a=0;a<i.length;a++){var n=i[a].split(",");if(!(n.length<1)){var o=n[0];e+=""==e?o:","+o}}return e},lazyLoadCmsPicture:function(){"true"==this.searchTab[0].getAttribute("advInfoSuccess")?this.sliderPic():hotelPageController.getCmsPicture(!0,l.addEvent(this,function(t){t&&t.value?this.all_search.before(t.value):this.all_search.before('<div class="banner_wrap"><ul class="pic_show"><li style="display: block;"><a target="_blank" style="background:url(http://img.elongstatic.com/index/bannerwrap/default.png) no-repeat center bottom;"></a></li></ul></div>'),this.sliderPic()}),l,"GET","json")},sliderPic:function(){r(".banner_wrap").unslider({dots:!0,fluid:!0})},ondisPlaneTricketTabs:function(t){r("#discount_plane_trickets").html("");var e=l.event.element(t);e.parent().find("span").removeClass("on"),this.disPlaneTricketTabs.unbind();var i=e.attr("csn");e.addClass("on"),r("#discount_plane_tricket").find(".loading_faile").hide(),r("#flight_loading").show(),r("#discount_plane_trickets").hide(),this.getFlightPromotion(i)},getFlightPromotion:function(e){if(this.FlightPromotion&&0<this.FlightPromotion.length)for(var t=0;t<this.FlightPromotion.length;t++)if(this.FlightPromotion[t].City==e)return void this.rendingPlaneTricket(this.FlightPromotion[t].Data,e);l.ajax.exec(this.flightJsonUrl,{city:e,recordcount:6},l.addEvent(this,function(t){this.rendingPlaneTricket(t,e)}),"GET","jsonp")},rendingPlaneTricket:function(t,e){if(r("#flight_loading").hide(),r("#discount_plane_trickets").show(),t!=undefined&&0<t.length){l.stringbuilder.clear();var i=this.hide_plane_tick_temp;for(n=0;n<t.length;n++)l.stringbuilder.append(l.template.convert(i,{Price:t[n].Price,FlyDate:this.formatJsonDate(t[n].FlyDate),FromCityName:t[n].FromCityName,ToCityName:t[n].ToCityName,Discount:0<t[n].Discount.toString().indexOf(".")&&3<t[n].Discount.toString().length?t[n].Round(t[n].Discount,1):t[n].Discount,URL:t[n].URL}));r("#discount_plane_trickets").append(l.stringbuilder.toString()),l.stringbuilder.clear();var a={City:e,Data:t};if(this.FlightPromotion&&0<this.FlightPromotion.length)for(var n=0;n<this.FlightPromotion.length;n++)if(this.FlightPromotion[n].City==e)return void this.disPlaneTricketTabs.bind("click",l.addEvent(this,this.ondisPlaneTricketTabs));this.FlightPromotion.push(a)}else r("#discount_plane_trickets").hide(),r("#discount_plane_trickets").parent().append(this.hide_loading_failed);this.disPlaneTricketTabs.bind("click",l.addEvent(this,this.ondisPlaneTricketTabs))},ondisTrainTricketTabs:function(t){var e=l.event.element(t),i=e.attr("index");this.disTrainTricketTabs.removeClass("on"),e.addClass("on"),r("#discount_train_trickets>ul").hide(),r("#discount_train_trickets>ul:nth-child("+i+")").show()},getTrainPromotion:function(){hotelPageController.getTrainTickt(l.addEvent(this,function(t){if(t&&t.value&&t.value.retcode&&"200"==t.value.retcode&&t.value.startEndHotList&&0<t.value.startEndHotList.length){var e=this.hide_train_tick_temp,a=this.getFormatDate(),n=new Date;for(n.setDate(n.getDate()+2),i=0;i<6;i++){for(dataCity=t.value.startEndHotList[i],hotStationName=t.value.startEndHotList[i].hotStationName,r(this.disTrainTricketTabs[i]).text(hotStationName+"鍑哄彂"),l.stringbuilder.clear(),j=0;j<6;j++){dataSub=dataCity.list[j];var o="https://m.elong.com/railway/list.html?startstation="+dataSub.fromStationName+"&endstation="+dataSub.toStationName+"&startdate="+n.format("yyyy-MM-dd")+"#/",s=l.template.convert(e,{url:o,fromStationName:dataSub.fromStationName,toStationName:dataSub.toStationName,time:a,lowerPrice:dataSub.lowerPrice});l.stringbuilder.append(s)}r("#discount_train_trickets>ul:nth-child("+(i+1)+")").append(l.stringbuilder.toString()),l.stringbuilder.clear()}}else r("#discount_train_trickets").html(""),r("#discount_train_trickets").append(this.hide_loading_failed)}),l,"GET","json")},ongo2HotelListClick:function(t){this.domesticDiv.find("[data-bindid='search']").click()},formatJsonDate:function(t){var e,i=t.indexOf("+");e=t.substring(6,i);var a=new Date;a.setTime(e);var n=a.getMonth()+1,o=a.getDate();return(n=n<10?"0"+n:n)+"鏈�"+(o=o<10?"0"+o:o)+"鏃�"},getFormatDate:function(){var t=new Date;t.setDate(t.getDate()+2);var e=t.getMonth()+1;return 1==e.toString().length&&(e="0"+e),e+"鏈�"+t.getDate()+"鏃�"},initializeData:function(){if(this.language="cn",this.flightJsonUrl="http://flight.elong.com/lowestdiscount.jsonp",this.trainJsonUrl="http://trainapi.elong.com/start_end_hot_list.jsonp",this.hide_fav_temp='<li><div class="pic_100 left"><a href="<#=Url#>" target="_blank"><img src="<#=Image_Url#>" onerror="this.src="http://m.elongstatic.com/static/webapp/pc_static/pc_hotel/other/home/pic/my_record_noimg.png"" alt=""  style="width:100px; height:100px;"/></a></div><div class="inf"><h5><a title="<#=Name#>" href="<#=Url#>" target="_blank"><#=Name#></a></h5><p><#=Address#></p><#=Price#></div></li>',this.hide_comment_temp='<li><div class="pic_100 left"><a href="<#=Hotel_Url#>" target="_blank"><img src="<#=Image_Url#>" onerror="this.src="http://m.elongstatic.com/static/webapp/pc_static/pc_hotel/other/home/pic/my_record_noimg.png"" alt="" style="width:100px; height:100px;" /></a></div><div class="inf"><h5><a title="<#=Name#>" href="<#=Hotel_Url#>" target="_blank"><#=Name#></a></h5><p class="comment_btn mt10"><a href="<#=Url#>" target="_blank"><i class="ei_icon icon027 mt5"></i>鎴戣鐐硅瘎</a></p></div></li>',this.hide_plane_tick_temp='<li><a href="<#=URL#>" target="_blank"><span class="data_tp mt20 ml20"><b class="a_city"><#=FromCityName#></b><i class="ei_icon icon08 left mt5"></i><b class="a_city"><#=ToCityName#></b></span><span class="data_bp ml20 mt10"><b class="a_date"><#=FlyDate#></b><em class="left"><span><#=Discount#></span>鎶�</em><b class="a_price"><s>楼</s><#=Price#></b></span></a></li>',this.hide_train_tick_temp='<li><a href="<#=url#>" target="_blank"><span class="data_tp mt20 ml20"><b class="a_city"><#=fromStationName#></b><i class="ei_icon icon011 left mt5"></i><b class="a_city"><#=toStationName#></b></span><span class="data_bp ml20 mt10"><b class="a_date"><#=time#></b><em class="left"></em><b class="a_price"><s>楼</s><#=lowerPrice#></b></span></a></li>',this.hide_loading_failed='<div class="wrpa1000 loading_faile_wrap"><div class="loading_faile"><span>鏁版嵁鍔犺浇澶辫触锛�<a href="javascript:location.reload();">閲嶆柊鍔犺浇</a></span></div></div>',this.vmData){var t=this.domesticDiv.find("input[data-bindid='city']"),e=this.domesticDiv.find("input[data-bindid='checkIn']"),i=this.domesticDiv.find("input[data-bindid='checkOut']");t.val(this.vmData.cityName),t.attr("cityname",this.vmData.cityName),t.attr("citynameen",this.vmData.citySeoNameEn),t.attr("citynamecn",this.vmData.cityNameCn),t.attr("cityid",this.vmData.cityId),t.attr("value",this.vmData.cityName),e.attr("selectedValue",this.vmData.checkInDateStr),e.val(this.vmData.checkInDateStr),i.attr("selectedValue",this.vmData.checkOutDateStr),i.val(this.vmData.checkOutDateStr)}}}))});
